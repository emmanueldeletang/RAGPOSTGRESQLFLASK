{% extends "base.html" %}

{% block title %}System Prompt - PostgreSQL Chat App{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="bi bi-pencil-square"></i> System Prompt Management</h2>
        <p class="text-muted">Customize how the AI assistant behaves and responds to your questions.</p>
    </div>
</div>

<div class="row mt-3">
    <!-- Left Column: Create New Prompt -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <i class="bi bi-plus-circle"></i> Create New System Prompt
            </div>
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="action" value="save">
                    <div class="mb-3">
                        <label for="prompt_name" class="form-label">Prompt Name</label>
                        <input type="text" class="form-control" id="prompt_name" name="prompt_name" placeholder="e.g., Technical Support, Sales Assistant" required>
                        <div class="form-text">Give this prompt a descriptive name</div>
                    </div>
                    <div class="mb-3">
                        <label for="prompt_text" class="form-label">Prompt Text</label>
                        <textarea class="form-control" id="prompt_text" name="prompt_text" rows="10" required>{{ current_prompt }}</textarea>
                        <div class="form-text">Use <code>{username}</code> as a placeholder for the user's name.</div>
                    </div>
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-save"></i> Save New Prompt
                        </button>
                    </div>
                </form>
                
                <form method="POST" class="mt-3">
                    <input type="hidden" name="action" value="reset">
                    <div class="d-grid">
                        <button type="submit" class="btn btn-warning">
                            <i class="bi bi-arrow-counterclockwise"></i> Load Default Template
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Right Column: Saved Prompts List -->
    <div class="col-md-6">
        <div class="card mb-3">
            <div class="card-header bg-success text-white">
                <i class="bi bi-list-check"></i> Your Saved Prompts ({{ all_prompts|length }})
            </div>
            <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                {% if all_prompts %}
                    {% for prompt in all_prompts %}
                    <div class="card mb-3 {% if prompt.is_active %}border-success{% endif %}">
                        <div class="card-header {% if prompt.is_active %}bg-success text-white{% else %}bg-light{% endif %}">
                            <div class="d-flex justify-content-between align-items-center">
                                <strong>
                                    <i class="bi bi-{% if prompt.is_active %}check-circle-fill{% else %}circle{% endif %}"></i>
                                    {{ prompt.name }}
                                </strong>
                                {% if prompt.is_active %}
                                <span class="badge bg-light text-success">ACTIVE</span>
                                {% endif %}
                            </div>
                            <small class="text-{% if prompt.is_active %}light{% else %}muted{% endif %}">
                                <i class="bi bi-person"></i> {{ username }} | 
                                <i class="bi bi-calendar"></i> {{ prompt.date_added }}
                            </small>
                        </div>
                        <div class="card-body">
                            <pre class="small mb-3" style="white-space: pre-wrap; max-height: 200px; overflow-y: auto; background-color: #f8f9fa; padding: 10px; border-radius: 4px;">{{ prompt.text }}</pre>
                            
                            <div class="btn-group w-100" role="group">
                                {% if not prompt.is_active %}
                                <form method="POST" style="flex: 1;">
                                    <input type="hidden" name="action" value="activate">
                                    <input type="hidden" name="prompt_id" value="{{ prompt.id }}">
                                    <button type="submit" class="btn btn-sm btn-success w-100">
                                        <i class="bi bi-check-circle"></i> Activate
                                    </button>
                                </form>
                                {% else %}
                                <button class="btn btn-sm btn-success w-50" disabled>
                                    <i class="bi bi-check-circle-fill"></i> Currently Active
                                </button>
                                {% endif %}
                                
                                {% if not prompt.is_active %}
                                <form method="POST" style="flex: 1;" onsubmit="return confirm('Are you sure you want to delete this prompt?');">
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="prompt_id" value="{{ prompt.id }}">
                                    <button type="submit" class="btn btn-sm btn-danger w-100">
                                        <i class="bi bi-trash"></i> Delete
                                    </button>
                                </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> No saved prompts yet. Create your first prompt using the form on the left!
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-info text-white">
                <i class="bi bi-lightbulb"></i> Tips for Effective Prompts
            </div>
            <div class="card-body">
                <ul class="small">
                    <li><strong>Be clear and specific</strong> about what the AI should do</li>
                    <li>Use <code>{username}</code> to personalize responses</li>
                    <li>Define the <strong>tone and style</strong> you want</li>
                    <li>Create different prompts for different purposes</li>
                    <li>Include instructions on handling data and citing sources</li>
                </ul>
                
                <h6 class="mt-3">Example Prompt Types:</h6>
                <ul class="small">
                    <li><strong>Technical Support</strong> - Detailed, step-by-step answers</li>
                    <li><strong>Sales Assistant</strong> - Persuasive, benefit-focused</li>
                    <li><strong>Data Analyst</strong> - Numbers-focused, analytical</li>
                    <li><strong>Teacher</strong> - Educational, patient explanations</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
